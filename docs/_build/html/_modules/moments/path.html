

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>moments.path &mdash; Moments 2.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Moments 2.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Moments 2.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for moments.path</h1><div class="highlight"><pre>
<span class="c"># ----------------------------------------------------------------------------</span>
<span class="c"># moments</span>
<span class="c"># Copyright (c) 2009-2010, Charles Brandt</span>
<span class="c"># </span>
<span class="c"># Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="c"># of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="c"># in the Software without restriction, including without limitation the rights</span>
<span class="c"># to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="c"># copies of the Software, and to permit persons to whom the Software is</span>
<span class="c"># furnished to do so, subject to the following conditions:</span>
<span class="c"># </span>
<span class="c"># The above copyright notice and this permission notice shall be included in</span>
<span class="c"># all copies or substantial portions of the Software.</span>
<span class="c"># </span>
<span class="c"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="c"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="c"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="c"># AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="c"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="c"># OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<span class="c"># THE SOFTWARE.</span>
<span class="c"># ----------------------------------------------------------------------------</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module helps in interacting with the filesystem.</span>
<span class="sd">The main focus is on abstracting files and directories and paths.</span>

<span class="sd">Path loads Files, Directories, etc.</span>
<span class="sd">Files have a path associated with them.</span>
<span class="sd">Directories are a collection of Paths (that link to other files and directories).</span>

<span class="sd">There is a circular dependency with these objects, so they need to be kept in one file.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">subprocess</span><span class="o">,</span> <span class="nn">cPickle</span><span class="o">,</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">urllib</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">timestamp</span> <span class="kn">import</span> <span class="n">Timestamp</span>
<span class="kn">from</span> <span class="nn">journal</span> <span class="kn">import</span> <span class="n">Journal</span>
<span class="kn">from</span> <span class="nn">tag</span> <span class="kn">import</span> <span class="n">Tags</span>

<div class="viewcode-block" id="check_ignore"><a class="viewcode-back" href="../../api/path.html#moments.path.check_ignore">[docs]</a><span class="k">def</span> <span class="nf">check_ignore</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ignores</span><span class="o">=</span><span class="p">[]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    take a string (item)</span>
<span class="sd">    and see if any of the strings in ignores list are in the item</span>
<span class="sd">    if so ignore it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ignore</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ignores</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
            <span class="c">#print &quot;ignoring item: %s for ignore: %s&quot; % (item, i)</span>
            <span class="n">ignore</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">ignore</span>
</div>
<div class="viewcode-block" id="load_journal"><a class="viewcode-back" href="../../api/path.html#moments.path.load_journal">[docs]</a><span class="k">def</span> <span class="nf">load_journal</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    helper to simplify call</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">load_journal</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="load_instance"><a class="viewcode-back" href="../../api/path.html#moments.path.load_instance">[docs]</a><span class="k">def</span> <span class="nf">load_instance</span><span class="p">(</span><span class="n">instances</span><span class="o">=</span><span class="s">&quot;/c/instances.txt&quot;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    load instances.txt journal</span>
<span class="sd">    look for the newest entry with tag </span>
<span class="sd">    return the data of the entry as a list of each file/line</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">load_journal</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c">#if j.tag(tag):</span>
        <span class="c">#    entries = j.tag(tag]</span>
        <span class="c">#else:</span>
        <span class="c">#    entries = []</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">j</span>
        
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">entries</span><span class="p">):</span>
        <span class="c">#for sorting a list of entries:</span>
        <span class="n">j2</span> <span class="o">=</span> <span class="n">Journal</span><span class="p">()</span>
        <span class="n">j2</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">j2</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&#39;reverse-chronological&#39;</span><span class="p">)</span>

        <span class="c">#should be the newest entry with tag &quot;tag&quot;</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="c">#get rid of any empty strings from blank lines</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                
        <span class="c">#print items</span>
        <span class="k">return</span> <span class="n">items</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;No instance entry found in journal: </span><span class="si">%s</span><span class="s"> for tag: </span><span class="si">%s</span><span class="s"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
        </div>
<div class="viewcode-block" id="name_only"><a class="viewcode-back" href="../../api/path.html#moments.path.name_only">[docs]</a><span class="k">def</span> <span class="nf">name_only</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    opposite of extension()</span>
<span class="sd">    return the filename without any extension</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#make sure there is an extension</span>
    <span class="c">## new_name = &#39;&#39;</span>
    <span class="c">## #if name starts with a period, this will recurse infinitely:</span>
    <span class="c">## #if re.search(&#39;\.&#39;, name) and not re.match(&#39;\.&#39;, name):</span>
    <span class="c">## if re.search(&#39;\.&#39;, name):</span>
    <span class="c">##     parts = name.split(&#39;.&#39;)</span>
    <span class="c">##     only = parts[:-1]</span>
    <span class="c">##     temp = &#39;.&#39;.join(only)</span>
    <span class="c">##     new_name = temp</span>
    <span class="c">## else:</span>
    <span class="c">##     new_name = name</span>
    <span class="c">## #print new_name</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">new_name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">new_name</span>
</div>
<div class="viewcode-block" id="extension"><a class="viewcode-back" href="../../api/path.html#moments.path.extension">[docs]</a><span class="k">def</span> <span class="nf">extension</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    turns out that this is similar to os.path.splitext()</span>
<span class="sd">    but will only return the extension (not both parts)</span>
<span class="sd">    </span>
<span class="sd">    find a file&#39;s file extension (part of filename after last &#39;.&#39;)</span>

<span class="sd">    splitting into a list with two items:</span>
<span class="sd">    prefix, extension = f.name.split(&quot;.&quot;)</span>
<span class="sd">    will not work with file names with multiple &#39;.&#39;s in them</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#could also check if there is a &#39;.&#39; in the string, return none if not</span>
    <span class="c">#parts = name.split(&#39;.&#39;)</span>
    <span class="n">parts</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">extension</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c">#print extension</span>
    <span class="k">return</span> <span class="n">extension</span>


<span class="c">#from paths import *</span>
<span class="c">#unless defined elsewhere, </span>
<span class="c">#will assume all paths passed in to Node objects are relative to this dir:</span>
<span class="c">## relative_prefix = &#39;&#39;</span>
<span class="c">## local_path = u&#39;./&#39;</span>
<span class="c">## log_path = u&#39;./&#39;</span>
<span class="c">## sort_config = &#39;alpha&#39;</span>

<span class="c">## config_log_in_outgoing = False</span>
<span class="c">## config_log_in_media = False</span>
<span class="c">## try:</span>
<span class="c">##     #if not using in pylons, can define manually above</span>
<span class="c">##     from pylons import config</span>
<span class="c">##     if config.has_key(&#39;local_path&#39;):</span>
<span class="c">##         local_path = unicode(config[&#39;local_path&#39;])</span>
<span class="c">##     if config.has_key(&#39;log_local_path&#39;):</span>
<span class="c">##         log_path = unicode(config[&#39;log_local_path&#39;])</span>
<span class="c">##         config_log_in_outgoing = True</span>
<span class="c">##     if config.has_key(&#39;log_in_media&#39;) and config[&#39;log_in_media&#39;] == &quot;True&quot;:</span>
<span class="c">##         config_log_in_media = True</span>
<span class="c">##     if config.has_key(&#39;sort_order&#39;):</span>
<span class="c">##         sort_config = config[&#39;sort_order&#39;]</span>
<span class="c">##     if config.has_key(&#39;relative_prefix&#39;):</span>
<span class="c">##         relative_prefix = config[&#39;relative_prefix&#39;]</span>
<span class="c">## except:</span>
<span class="c">##     config = {}</span>


</div>
<div class="viewcode-block" id="Path"><a class="viewcode-back" href="../../api/path.html#moments.path.Path">[docs]</a><span class="k">class</span> <span class="nc">Path</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    a path to a specific destination</span>

<span class="sd">    represented as a string with separators</span>

<span class="sd">    very similar in purpose to os.path</span>

<span class="sd">    is not involved with what is contained at the path destination</span>

<span class="sd">    this is a collection of common operations needed for manipulating paths,</span>
<span class="sd">    in some cases wrapping the standard library os.path module</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">relative_prefix</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        take either a relative or absolute path</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">#these get set in parse_path and parse_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">relative_prefix</span> <span class="o">=</span> <span class="n">relative_prefix</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">parts</span><span class="p">,</span> <span class="n">relative</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">relative_prefix</span><span class="p">)</span>

        <span class="c">#file (local), http, smb, etc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">separator</span> <span class="o">=</span> <span class="s">&#39;/&#39;</span>
        

        <span class="c">#todo, general name for storage objects...</span>
        <span class="c">#instances?  Node is *too* abstract... other things can be a node</span>
        <span class="c">#but file is too specific</span>
        <span class="c">#local instance? binary representation?</span>
        
        <span class="c">#if a node has been loaded, can reference it here</span>
        <span class="c">#or this could also be a property</span>
        <span class="c">#that loads the node when called.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c">#parent object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c">#self.filename = self._full_name</span>
        
    <span class="k">def</span> <span class="nf">_get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span>
    <span class="k">def</span> <span class="nf">_set_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_filename</span><span class="p">,</span> <span class="n">_set_filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_set_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_path</span><span class="p">,</span> <span class="n">_set_path</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#this will fail if path has unicode characters it doesn&#39;t know </span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">parse_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="c">#name without file extension:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name_only</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">=</span> <span class="n">extension</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_full_name</span> <span class="o">=</span> <span class="n">name</span>

<div class="viewcode-block" id="Path.expand"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.expand">[docs]</a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check if we start with a &#39;.&#39; something</span>
<span class="sd">        expand and reparse</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^\.&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="c">#print path</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^/&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;./&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="c">#print &quot;Assuming relative, adding &#39;./&#39; prefix: %s&quot; % path</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="c">#otherwise must already be expanded... do nothing</span>
        </div>
    <span class="k">def</span> <span class="nf">parse_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">parts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">local_path</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="c">#print &quot;parsing path: %s&quot; % path</span>
        <span class="c">#print &quot;-&gt;%s&lt;-&quot; % path</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="s">&quot;Need either path or parts&quot;</span>

        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="s">&quot;.&quot;</span><span class="p">:</span>
                <span class="c">#special case... this will not get parsed correctly without</span>
                <span class="c">#expanding it:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="c">#print path</span>
                <span class="c">#path = os.path.abspath()</span>
            <span class="c">#self._dirname = path</span>
            <span class="c">#could check if it is an actual path here</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_parts</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">relative</span><span class="p">:</span>
            <span class="n">actual_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">local_path</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span><span class="p">)</span>
            <span class="n">actual_path</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">actual_path</span><span class="p">)</span>
            <span class="n">actual_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">actual_path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span> <span class="o">=</span> <span class="n">actual_path</span>

        <span class="c">#*2010.03.13 09:59:05</span>
        <span class="c">#maybe it should be file_name or _file_name instead of full_name???</span>
            
        <span class="c">#this should be a property, that combines name and extension</span>
        <span class="c">#self.full_name = &#39;&#39;</span>

        <span class="c">#http://docs.python.org/lib/module-os.path.html        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_full_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_full_name</span><span class="p">:</span>
            <span class="c">#might have been passed in a path with a trailing &#39;/&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_full_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dirname</span><span class="p">)</span>
        <span class="c">#print &quot;fullname: %s&quot; % self._full_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_full_name</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">from_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parts</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span>
                   
<div class="viewcode-block" id="Path.type"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.type">[docs]</a>    <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        determine the subclass that should be associated with this Path</span>
<span class="sd">        this gives us a central place to track this</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#PCD image format seems to cause a lot of trouble</span>
        <span class="n">image_extensions</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;.jpg&#39;</span><span class="p">,</span> <span class="s">&#39;.png&#39;</span><span class="p">,</span> <span class="s">&#39;.gif&#39;</span><span class="p">,</span> <span class="s">&#39;.jpeg&#39;</span><span class="p">,</span> <span class="s">&#39;.JPG&#39;</span><span class="p">,</span> <span class="s">&#39;.tif&#39;</span> <span class="p">]</span>
        <span class="n">movie_extensions</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;.mpg&#39;</span><span class="p">,</span> <span class="s">&#39;.avi&#39;</span><span class="p">,</span> <span class="s">&#39;.flv&#39;</span><span class="p">,</span> <span class="s">&#39;.vob&#39;</span><span class="p">,</span> <span class="s">&#39;.wmv&#39;</span><span class="p">,</span> <span class="s">&#39;.AVI&#39;</span><span class="p">,</span> <span class="s">&#39;.iso&#39;</span><span class="p">,</span> <span class="s">&#39;.asf&#39;</span><span class="p">,</span> <span class="s">&#39;.mp4&#39;</span> <span class="p">]</span>

        <span class="c">#, &#39;m4p&#39; are not playable by flash, should convert to use</span>
        <span class="n">sound_extensions</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;.mp3&#39;</span><span class="p">,</span> <span class="s">&#39;.wav&#39;</span><span class="p">,</span> <span class="s">&#39;.aif&#39;</span><span class="p">,</span> <span class="s">&#39;.ogg&#39;</span> <span class="p">]</span>

        <span class="n">journal_extensions</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;.txt&#39;</span><span class="p">,</span> <span class="s">&#39;.log&#39;</span> <span class="p">]</span>

        <span class="c">#others</span>
        <span class="c">#playlist_extensions = [ &#39;m3u&#39;, &#39;pls&#39; ]</span>
        <span class="c">#document_extensions = [ &#39;html&#39;, &#39;htm&#39;, &#39;mako&#39; ]</span>

        <span class="c">#determine what the right type of node should be based on path</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)):</span>
            <span class="c">#ext = extension(self.name)</span>
            <span class="c">#print &quot;Extension: %s&quot; % self.extension</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">image_extensions</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Image&quot;</span>
            <span class="k">elif</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">movie_extensions</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Movie&quot;</span>
            <span class="k">elif</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">sound_extensions</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Sound&quot;</span>
            <span class="k">elif</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">journal_extensions</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;Log&quot;</span>
            <span class="c">#elif ext in library_extensions:</span>
            <span class="c">#    return &quot;Library&quot;</span>
            <span class="c">#elif ext in playlist_extensions:</span>
            <span class="c">#    return &quot;Playlist&quot;</span>
            <span class="c">#elif ext in document_extensions:</span>
            <span class="c">#    return &quot;Document&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&quot;File&quot;</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)):</span>
            <span class="k">return</span> <span class="s">&quot;Directory&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Node... exists? </span><span class="si">%s</span><span class="s"> Unknown filetype: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="c">#return &quot;Node&quot;</span>
</div>
<div class="viewcode-block" id="Path.load"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a storage.Node of the destination</span>

<span class="sd">        can look at types here</span>
<span class="sd">        and return the appropriate type</span>

<span class="sd">        looks at the path,</span>
<span class="sd">        determines the right kind of storage object to associate with that path</span>
<span class="sd">        returns the storage object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_node</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">create</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">==</span> <span class="s">&quot;.txt&quot;</span><span class="p">):</span>
            <span class="c">#only want to create new log files, and then only if logging</span>
            <span class="c">#is enabled</span>
            <span class="c">#should be equivalent to a touch</span>

            <span class="c">#f = file(self.path, &#39;w&#39;)</span>
            <span class="c">#f.close()</span>
            <span class="c">#print &quot;creating&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>

        <span class="c">#to skip throwing an error if no file exists, uncomment following:</span>
        <span class="c">#if os.path.exists(self.path):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">node_type</span><span class="p">:</span>
            <span class="n">node_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span>
            <span class="c">## new_node = Node(self.path)</span>
            <span class="c">## node_type = new_node.find_type()</span>
            <span class="c">## if node_type in [ &quot;Playlist&quot;, &quot;Movie&quot;, &quot;Document&quot;, &quot;Library&quot;, &quot;Log&quot; ]:</span>
            <span class="c">##     #special case</span>
            <span class="c">##     node_type = &quot;File&quot;</span>

        <span class="c">#ah ha!</span>
        <span class="c">#passing in path as unicode is very important if planning to work</span>
        <span class="c">#with unicode paths... otherwise gets converted to ascii here:</span>
        <span class="c">#new_node = eval(&quot;%s(u&#39;%s&#39;)&quot; % (node_type, self.path))</span>
        <span class="c">#above is causing trouble on windows, trying without</span>

        <span class="c">#node_create = &quot;%s(r&#39;%s&#39;)&quot; % (node_type, self.path)</span>
        <span class="c">#node_create = r&#39;%s(&quot;%s&quot;)&#39; % (node_type, self.path)</span>
        <span class="c">#re.subn(r&quot;\\&quot;, r&quot;\\\\&quot;, node_create)</span>
        <span class="c">#new_node = eval(node_create)</span>

        <span class="c">#2008.12.23 14:18:59</span>
        <span class="c">#eval having a hard time with windows.  switching to a nested if-else:</span>

        <span class="c">## if node_type == &quot;Node&quot;:</span>
        <span class="c">##     #new_node already defined:</span>
        <span class="c">##     pass</span>
        <span class="k">if</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s">&quot;Directory&quot;</span><span class="p">:</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="n">Directory</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">node_type</span> <span class="o">==</span> <span class="s">&quot;Image&quot;</span><span class="p">:</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c">#elif node_type == &quot;Sound&quot;:</span>
        <span class="c">#    new_node = Sound(self.path)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># node_type == &quot;File&quot;:</span>
            <span class="n">new_node</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_node</span>
</div>
<div class="viewcode-block" id="Path.load_journal"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.load_journal">[docs]</a>    <span class="k">def</span> <span class="nf">load_journal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">add_tags</span><span class="o">=</span><span class="p">[],</span> <span class="n">subtract_tags</span><span class="o">=</span><span class="p">[],</span>
                     <span class="n">include_path_tags</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        walk the given path and</span>
<span class="sd">        create a journal object from all logs encountered in the path</span>

<span class="sd">        create a temporary, in memory, journal from logs</span>

<span class="sd">        this works for both directories and log files</span>

<span class="sd">        *2009.06.18 12:38:45</span>

<span class="sd">        this was started to be abstracted from osbrowser in player.py.  </span>
<span class="sd">        By moving here, we minimize dependencies outside of Moments module</span>

<span class="sd">        load_journal cannot guarantee that the returned Journal item will have a</span>
<span class="sd">        filename (self.path) associated with it for later saving.</span>

<span class="sd">        in that case should use:</span>
<span class="sd">        ::</span>

<span class="sd">          j = Journal()</span>
<span class="sd">          j.load(path, add_tags=these_tags)</span>

<span class="sd">        -or-</span>
<span class="sd">        ::</span>

<span class="sd">          j = load_journal(path)</span>
<span class="sd">          j.path = destination</span>

<span class="sd">        of course you can always pass the path in explicitly to save:</span>
<span class="sd">        save(filename=path)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#ignore_dirs = [ &#39;downloads&#39;, &#39;binaries&#39; ]</span>

        <span class="c">#this would be the place to add .hgignore items to the ignore_items list</span>
        <span class="n">ignore_items</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;downloads&#39;</span><span class="p">,</span> <span class="s">&#39;index.txt&#39;</span> <span class="p">]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">Journal</span><span class="p">()</span>
        <span class="n">log_check</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;.*\.txt$&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">root</span><span class="p">,</span><span class="n">dirs</span><span class="p">,</span><span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="c">#make sure it at least is a log file (.txt):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">log_check</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_ignore</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">ignore_items</span><span class="p">):</span>
                        <span class="n">these_tags</span> <span class="o">=</span> <span class="n">add_tags</span><span class="p">[:]</span>
                        <span class="c">#will need to abstract context_tags() too... move to Tags</span>
                        <span class="k">if</span> <span class="n">include_path_tags</span><span class="p">:</span>

                            <span class="c">#by default, we usually do not want to include</span>
                            <span class="c">#the tags for self.path</span>
                            <span class="c">#</span>
                            <span class="c">#only subsequent path tags</span>
                            <span class="c">#</span>
                            <span class="c">#and only non-compact date tags</span>

                            <span class="c">#find suffix:</span>
                            <span class="n">cur_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>

                            <span class="n">relative_path</span> <span class="o">=</span> <span class="n">cur_path</span><span class="o">.</span><span class="n">to_relative</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
                            <span class="c">#print relative_path</span>
                            <span class="n">relative_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">relative_path</span><span class="p">))</span>

                            <span class="n">filename_tags</span> <span class="o">=</span> <span class="n">relative_path</span><span class="o">.</span><span class="n">to_tags</span><span class="p">()</span>

                            <span class="c">#journal.txt is often used as a default name</span>
                            <span class="c">#in repositories</span>
                            <span class="c">#but does not really indicate anything</span>
                            <span class="c">#about the entries themselves (watered down)</span>
                            <span class="c">#ok to remove if added by path</span>
                            <span class="k">if</span> <span class="s">&quot;journal&quot;</span> <span class="ow">in</span> <span class="n">filename_tags</span><span class="p">:</span>
                                <span class="n">filename_tags</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;journal&quot;</span><span class="p">)</span>
                                
                            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">filename_tags</span><span class="p">:</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">ts</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">(</span><span class="n">compact</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
                                <span class="k">except</span><span class="p">:</span>
                                    <span class="c">#if it&#39;s *not* a valid timestamp,</span>
                                    <span class="c">#then we want to keep it as a tag</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;01&#39;</span> <span class="ow">and</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;02&#39;</span> <span class="ow">and</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;03&#39;</span> <span class="ow">and</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;04&#39;</span> <span class="ow">and</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;05&#39;</span> <span class="ow">and</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;06&#39;</span> <span class="ow">and</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;07&#39;</span> <span class="ow">and</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;08&#39;</span> <span class="ow">and</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;09&#39;</span> <span class="ow">and</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;10&#39;</span> <span class="ow">and</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;11&#39;</span> <span class="ow">and</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#39;12&#39;</span><span class="p">):</span>
                                        <span class="n">these_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                                    <span class="c">#print &quot;adding: %s&quot; % t</span>
                            
                            

                        <span class="c">#subtract tags last:</span>
                        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">subtract_tags</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">these_tags</span><span class="p">:</span>
                                <span class="n">these_tags</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
                        <span class="n">j</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">f</span><span class="p">),</span> <span class="n">add_tags</span><span class="o">=</span><span class="n">these_tags</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span> <span class="n">log_check</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="n">j</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">add_tags</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">create</span> <span class="ow">and</span> <span class="n">log_check</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="c">#make a new log:</span>
            <span class="n">j</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="n">j</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">add_tags</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#no journal to create</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">j</span>
</div>
<div class="viewcode-block" id="Path.exists"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check if the actual path exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Path.created"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.created">[docs]</a>    <span class="k">def</span> <span class="nf">created</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        wrapper shortcut for getting the modified timestamp of the path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="Path.create"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        see if we have an extension</span>
<span class="sd">        create a blank file if so</span>

<span class="sd">        otherwise make a new directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#print &quot;Extension: %s&quot; % self.extension</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">extension</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mode</span><span class="p">:</span>
                <span class="c">#os.mkdir(self.path, mode)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">#os.mkdir(self.path)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;Directory&quot;</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
        <span class="n">destination</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">destination</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

<div class="viewcode-block" id="Path.copy"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        wrapping os call</span>
<span class="sd">        seems like there was trouble doing this if it crossed devices</span>
<span class="sd">        needed a system call in that case</span>
<span class="sd">        http://docs.python.org/library/shutil.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">destination</span><span class="p">)</span>
        
    <span class="c">#???</span></div>
<div class="viewcode-block" id="Path.make_tree"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.make_tree">[docs]</a>    <span class="k">def</span> <span class="nf">make_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        go through all parts and make a node for each of them</span>
<span class="sd">        return the root node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="c">#def parent_path(self):</span></div>
<div class="viewcode-block" id="Path.parent"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.parent">[docs]</a>    <span class="k">def</span> <span class="nf">parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a Path object to our parent</span>
<span class="sd">        don&#39;t want to do this on initialization,</span>
<span class="sd">        since it would recursively call</span>
<span class="sd">        </span>
<span class="sd">        Similar in concept to:</span>
<span class="sd">        os.path.dirname(self.path)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#make sure we have all the parts we can get:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">!=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span> <span class="ow">and</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)):</span>
            
            <span class="n">parent_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
            <span class="c">#print parent_path</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">parent_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">parent</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#special case for root path</span>
            <span class="k">return</span> <span class="bp">None</span>
            <span class="c">#return self #???</span>
        
    <span class="c">#aka split_path</span>
    <span class="c">#as_list</span></div>
<div class="viewcode-block" id="Path.parts"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.parts">[docs]</a>    <span class="k">def</span> <span class="nf">parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a list of all parts of the path</span>
<span class="sd">        (os.path.split only splits into two parts, this does all)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#we&#39;ll be chopping this up</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>

        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c">#make sure our path starts with a slash for a common end case</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^\/&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
            <span class="c">#print &quot;new: %s&quot; % path</span>
        <span class="k">while</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">path</span> <span class="o">!=</span> <span class="s">&#39;/&#39;</span><span class="p">:</span>
            <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span>

        <span class="c">#this will take care of windows paths that are being worked on in a unix environment manually</span>
        <span class="n">new_parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
            <span class="n">new_parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">))</span>

        <span class="n">parts</span> <span class="o">=</span> <span class="n">new_parts</span>

        <span class="c">#print parts</span>
        <span class="k">return</span> <span class="n">parts</span>

    <span class="c">#def path_to_tags(self):</span></div>
<div class="viewcode-block" id="Path.to_tags"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.to_tags">[docs]</a>    <span class="k">def</span> <span class="nf">to_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_name</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">include_parent</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        looks at the specified path to generate a list of tags</span>
<span class="sd">        based on the file name and location</span>

<span class="sd">        check if the last item in the path is a file with an extension</span>
<span class="sd">        get rid of the extension if so</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">all_tags</span> <span class="o">=</span> <span class="n">Tags</span><span class="p">()</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">and</span> <span class="n">include_parent</span><span class="p">:</span>
            <span class="n">path_parts</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">parts</span><span class="p">()</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">path_parts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_name</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c">#convert each item to tags individually</span>
        <span class="c">#each item in a path could be made up of multiple tags</span>
        <span class="c">#i.e work-todo</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
                <span class="n">part_tags</span> <span class="o">=</span> <span class="n">Tags</span><span class="p">()</span><span class="o">.</span><span class="n">from_tag_string</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">part_tags</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">tag</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_tags</span><span class="p">:</span>
                        <span class="n">all_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_tags</span>
</div>
<div class="viewcode-block" id="Path.distance"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.distance">[docs]</a>    <span class="k">def</span> <span class="nf">distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        the shortest number of nodes between self and path</span>

<span class="sd">        find common prefix</span>
<span class="sd">        then count from there</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="c">#def local_to_relative(path=None, add_prefix=False):</span>
    <span class="c">#def to_relative(self, path=&#39;&#39;, leading_slash=False, extension=None):</span></div>
<div class="viewcode-block" id="Path.to_relative"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.to_relative">[docs]</a>    <span class="k">def</span> <span class="nf">to_relative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">extension</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        should work either way...</span>
<span class="sd">        returns the difference between the two paths (self.path and path)</span>
<span class="sd">        return value is just a string representation</span>
<span class="sd">        </span>
<span class="sd">        accept a path (either Path or path... will get resolved down to str)</span>
<span class="sd">        return the relative part</span>
<span class="sd">        by removing the path sent from our prefix</span>

<span class="sd">        convert a local file path into one acceptable for use as a relative path in a URL</span>

<span class="sd">        if node is a file, this will include the filename at the end</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relative_prefix</span>
        <span class="c">#want to make sure that the path we&#39;re looking at contains local_path</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">commonprefix</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">path</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
            <span class="c">#see if there is anything extra in the path part sent</span>
            <span class="n">temp_path</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">temp_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">prefix</span><span class="p">):]</span>
            
            <span class="c">## if leading_slash:</span>
            <span class="c">##     temp_path = self.path[len(prefix):]</span>
            <span class="c">## else:</span>
            <span class="c">##     temp_path = self.path[len(prefix)+1:]</span>
                
        <span class="c">#if re.search(r&#39;\\&#39;, temp_path):</span>
        <span class="c">#temp_path = re.subn(r&#39;\\&#39;, &#39;/&#39;, temp_path)</span>
        <span class="n">temp_path</span> <span class="o">=</span> <span class="n">temp_path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">r&#39;</span><span class="se">\\</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>

        <span class="c">#if add_prefix:</span>
        <span class="c">#    temp_path = os.path.join(config[&#39;relative_prefix&#39;], temp_path)</span>

        <span class="c"># this allows replacing an extension with something else</span>
        <span class="c"># used in gallery scripts to replace .jpg with .html</span>
        <span class="k">if</span> <span class="n">extension</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">temp_path</span><span class="p">)</span>
            <span class="n">temp</span><span class="o">.</span><span class="n">extension</span> <span class="o">=</span> <span class="n">extension</span>
            <span class="n">temp_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">temp_path</span>


    <span class="c">#should just use generalized local_to_relative if needed directly</span>
    <span class="c">#*2009.03.15 22:28:06</span>
    <span class="c">#in templates, is nice to have access to it through the object</span>
    <span class="c">#wrapping general one</span>
    <span class="c">#def relative_path(self, add_prefix=False):</span>
    <span class="c">#    return local_to_relative(self.path, add_prefix)</span>
    </div>
<div class="viewcode-block" id="Path.custom_relative_path"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.custom_relative_path">[docs]</a>    <span class="k">def</span> <span class="nf">custom_relative_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        method to change system path to viewer path</span>

<span class="sd">        if path on file system is different than path displayed by viewer</span>
<span class="sd">        generate it here</span>
<span class="sd">        </span>
<span class="sd">        ideally would just use routes here... heavy overlap        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>

        <span class="k">if</span> <span class="n">prefix</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">local_to_relative</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c">#return urllib.quote(os.path.join(prefix, local_to_relative(path)))</span>
                <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c">#return os.path.join(prefix, local_to_relative(path))</span>
                <span class="k">return</span> <span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#return urllib.quote(os.path.join(&#39;/&#39;, local_to_relative(path, add_prefix=True)))</span>
            <span class="k">return</span> <span class="n">urllib</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">local_to_relative</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">add_prefix</span><span class="o">=</span><span class="bp">True</span><span class="p">)]))</span>
</div>
<div class="viewcode-block" id="Path.relative_path_parts"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.relative_path_parts">[docs]</a>    <span class="k">def</span> <span class="nf">relative_path_parts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        split the pieces up so that they can be navigated</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_relative</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">path</span> <span class="o">!=</span> <span class="s">&#39;/&#39;</span><span class="p">:</span>
            <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">suffix</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">suffix</span><span class="p">,</span> <span class="n">path</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">prefix</span>
        <span class="k">return</span> <span class="n">parts</span>

</div>
<div class="viewcode-block" id="Path.log_action"><a class="viewcode-back" href="../../api/path.html#moments.path.Path.log_action">[docs]</a>    <span class="k">def</span> <span class="nf">log_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;view&quot;</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this is closely related to journal.log_action</span>
<span class="sd">        (don&#39;t forget to use that if it&#39;s easier)</span>
<span class="sd">        </span>
<span class="sd">        but sometimes it is inconvenient to think in terms of a journal</span>
<span class="sd">        when you are working with paths</span>

<span class="sd">        this assumes the journal to log into is &quot;action.txt&quot;</span>
<span class="sd">        if the path is a directory, look for it in the directory</span>
<span class="sd">        if the path is a file (more common)</span>
<span class="sd">        look for action.txt in the parent directory</span>

<span class="sd">        if logs need to be added anywhere else, use this concept, or journal.log_action</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;Directory&quot;</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d_path</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="n">dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="s">&quot;action.txt&quot;</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">load_journal</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c">#j = d.load_journal()</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">actions</span><span class="p">)</span>
        <span class="n">j</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">entry</span>
        

    
    <span class="c">#this is now parent().name:</span>
    <span class="c">## def parent_part(self):</span>
    <span class="c">##     &quot;&quot;&quot;</span>
    <span class="c">##     could consider returning actual parent here</span>
    <span class="c">##     return the suffix and path for the parent directory only</span>
    <span class="c">##     &quot;&quot;&quot;</span>
    <span class="c">##     parts = self.relative_path_parts()</span>
    <span class="c">##     return parts[-2]</span>


<span class="c">#from path import Path, load_journal</span>

<span class="c">#import os, re</span>
<span class="c">#from storage import *</span>
<span class="c">#from journal import Journal</span>

<span class="c">#RENAME LocalNode ???</span>
<span class="c">#StorageNode?</span>
<span class="c">#DriveNode?</span>

<span class="c">#class LocalNode(object):</span>
<span class="c">#class File(LocalNode):</span></div></div>
<div class="viewcode-block" id="File"><a class="viewcode-back" href="../../api/path.html#moments.path.File">[docs]</a><span class="k">class</span> <span class="nc">File</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    files are Nodes with sizes</span>
<span class="sd">    also leafs in tree structure</span>

<span class="sd">    could be a file or a directory</span>

<span class="sd">    one thing connected to other things on the filesystem</span>
<span class="sd">    </span>
<span class="sd">    structure to hold the meta data of a node on a filesystem</span>
<span class="sd">    should hold the common attributes of files and directories</span>

<span class="sd">    Node paths are the paths on the local system...</span>
<span class="sd">    i.e. how python would find them</span>

<span class="sd">    operations common to both files and directories</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c">#def __init__(self, **kwargs):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="c">#Node.__init__(self, **kwargs)</span>
        <span class="c">#LocalNode.__init__(self, path)</span>

        <span class="n">test</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="n">test</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c">#we don&#39;t initialize this since it could be a directory and</span>
        <span class="c">#we don&#39;t want to recurse unless needed</span>
        <span class="c">#can always call check_size later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_stats</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">md5</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c">#self.last_scan = None</span>
        <span class="c">#self.last_scan = datetime.now()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_scan</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#this will fail if path has unicode characters it doesn&#39;t know </span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="File.check_stats"><a class="viewcode-back" href="../../api/path.html#moments.path.File.check_stats">[docs]</a>    <span class="k">def</span> <span class="nf">check_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check and see what the operating system is reporting for</span>
<span class="sd">        this node&#39;s stats</span>
<span class="sd">        update our copy of the stats</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#http://docs.python.org/lib/os-file-dir.html</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="c">#st_atime (time of most recent access)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atime</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_atime</span>
        <span class="c">#st_mtime (time of most recent content modification)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mtime</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_mtime</span>
        <span class="c">#st_ctime (platform dependent; time of most recent metadata change on Unix, or the time of creation on Windows)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctime</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">st_ctime</span>        

    <span class="c">#*2010.12.21 09:23:04</span>
    <span class="c">#TODO:</span>
    <span class="c">#consider making size a property</span>
    <span class="c">#Directory uses this too</span></div>
<div class="viewcode-block" id="File.check_size"><a class="viewcode-back" href="../../api/path.html#moments.path.File.check_size">[docs]</a>    <span class="k">def</span> <span class="nf">check_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wraps os.path.getsize() to return the file&#39;s size.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span>
    </div>
<div class="viewcode-block" id="File.reset_stats"><a class="viewcode-back" href="../../api/path.html#moments.path.File.reset_stats">[docs]</a>    <span class="k">def</span> <span class="nf">reset_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        some actions (like image rotate) may update the file&#39;s modified times</span>
<span class="sd">        but we might want to keep the original time</span>
<span class="sd">        this resets them to what they were when originally initialized</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atime</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtime</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="File.change_stats"><a class="viewcode-back" href="../../api/path.html#moments.path.File.change_stats">[docs]</a>    <span class="k">def</span> <span class="nf">change_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">accessed</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">modified</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        take new values for the accessed and modified times and update the file&#39;s properties</span>
<span class="sd">        should only accept Timestamp values.</span>
<span class="sd">        Timestamp can be used for conversions as needed.</span>
<span class="sd">        then use Timestamp.epoch() to get right values here:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">accessed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">new_atime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">atime</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_atime</span> <span class="o">=</span> <span class="n">accessed</span><span class="o">.</span><span class="n">epoch</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">modified</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">new_mtime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtime</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_mtime</span> <span class="o">=</span> <span class="n">modified</span><span class="o">.</span><span class="n">epoch</span><span class="p">()</span>
            
        <span class="n">os</span><span class="o">.</span><span class="n">utime</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="p">(</span><span class="n">new_atime</span><span class="p">,</span> <span class="n">new_mtime</span><span class="p">))</span>

        <span class="c">#keeps/restores the originals:</span>
        <span class="c">#os.utime(self.path, (self.atime, self.mtime))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">check_stats</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="File.adjust_time"><a class="viewcode-back" href="../../api/path.html#moments.path.File.adjust_time">[docs]</a>    <span class="k">def</span> <span class="nf">adjust_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        wrap change stats in a more user friendly function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">modified</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">()</span>
        <span class="n">modified</span><span class="o">.</span><span class="n">from_epoch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtime</span><span class="p">)</span>
        <span class="c">#print &quot;Pre: %s&quot; % modified</span>

        <span class="c">#****configure your adjustment here****</span>
        <span class="n">modified</span> <span class="o">=</span> <span class="n">modified</span><span class="o">.</span><span class="n">future</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">hours</span><span class="p">)</span>
        <span class="c">#**************************************</span>

        <span class="n">accessed</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">()</span>
        <span class="n">accessed</span><span class="o">.</span><span class="n">from_epoch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">atime</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_stats</span><span class="p">(</span><span class="n">accessed</span><span class="p">,</span> <span class="n">modified</span><span class="p">)</span>

        <span class="c">#reset to check:</span>
        <span class="n">modified</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">()</span>
        <span class="n">modified</span><span class="o">.</span><span class="n">from_epoch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtime</span><span class="p">)</span>
        <span class="c">#print &quot;Post: %s&quot; % modified</span>
</div>
<div class="viewcode-block" id="File.move"><a class="viewcode-back" href="../../api/path.html#moments.path.File.move">[docs]</a>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rel_destination</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this utilizes the os.rename function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rel_parent</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">local_to_relative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">rel_parent</span><span class="p">,</span> <span class="n">rel_destination</span><span class="p">)</span>
        <span class="n">destination</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
        <span class="c">#new_dir = os.path.join(image_dir, data)</span>
        <span class="p">(</span><span class="n">new_dir</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

        <span class="c">#could also use os.renames()   note plural</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">new_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">new_dir</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtime</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span>

<div class="viewcode-block" id="File.day"><a class="viewcode-back" href="../../api/path.html#moments.path.File.day">[docs]</a>    <span class="k">def</span> <span class="nf">day</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        print creation time in a specific format</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtime</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%m/</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtime</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%H:%M&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtime</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y%m</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="File.timestamp"><a class="viewcode-back" href="../../api/path.html#moments.path.File.timestamp">[docs]</a>    <span class="k">def</span> <span class="nf">timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a corresponding moments Timestamp object for the file&#39;s mtime</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_stats</span><span class="p">()</span>
        <span class="n">modified</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">()</span>
        <span class="n">modified</span><span class="o">.</span><span class="n">from_epoch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtime</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">modified</span>
</div>
<div class="viewcode-block" id="File.make_md5"><a class="viewcode-back" href="../../api/path.html#moments.path.File.make_md5">[docs]</a>    <span class="k">def</span> <span class="nf">make_md5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        calculate the md5 hash for ourself</span>

<span class="sd">        could store this in metadata at some point</span>

<span class="sd">        http://docs.python.org/library/hashlib.html#module-hashlib</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">hashlib</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span><span class="s">&quot;rb&quot;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">md5</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="c">#not sure how this differs</span>
        <span class="c">#self.md5 = m.digest()</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">md5</span>
    

<span class="c">## #from sound import Sound</span>
<span class="c">## class Sound(File):</span>
<span class="c">##     &quot;&quot;&quot;</span>
<span class="c">##     object to hold sound/music specific meta data for local sound file</span>

<span class="c">##     &quot;&quot;&quot;</span>
<span class="c">##     def __init__(self, path):</span>
<span class="c">##         File.__init__(self, path)</span>

<span class="c">#from image import Image</span></div></div>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">Image</span> <span class="kn">as</span> <span class="nn">PILImage</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c">#also check for Pillow version of PIL:</span>
        <span class="kn">import</span> <span class="nn">PIL.Image</span> <span class="kn">as</span> <span class="nn">PILImage</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&quot;WARNING: Python Image Library not intalled.&quot;</span>
        <span class="k">print</span> <span class="s">&quot;Image manipulation will not work&quot;</span>

<div class="viewcode-block" id="Image"><a class="viewcode-back" href="../../api/path.html#moments.path.Image">[docs]</a><span class="k">class</span> <span class="nc">Image</span><span class="p">(</span><span class="n">File</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    object to hold Image specific meta data for an image locally available</span>

<span class="sd">    and rendering thumbnails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="n">File</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thumb_dir_name</span> <span class="o">=</span> <span class="s">&quot;sized&quot;</span>
        <span class="c">#2010.03.02 22:43:35 </span>
        <span class="c"># could use the actual path object to handle this </span>
        <span class="c">#parent_dir_path = os.path.dirname(str(self.path))</span>
        <span class="c">#self.thumb_dir_path = os.path.join(parent_dir_path, self.thumb_dir_name)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thumb_dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="p">()),</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">thumb_dir_name</span><span class="p">)</span>
        
        <span class="c">#self.sizes = { &#39;tiny_o&#39;:&#39;_t_o&#39;, &#39;tiny&#39;:&#39;_t&#39;, &#39;small&#39;:&#39;_s&#39;, &#39;medium&#39;:&#39;_m&#39;, &#39;large&#39;:&#39;_l&#39; }</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;tiny&#39;</span><span class="p">:</span><span class="s">&#39;_t&#39;</span><span class="p">,</span> <span class="s">&#39;small&#39;</span><span class="p">:</span><span class="s">&#39;_s&#39;</span><span class="p">,</span> <span class="s">&#39;medium&#39;</span><span class="p">:</span><span class="s">&#39;_m&#39;</span><span class="p">,</span> <span class="s">&#39;large&#39;</span><span class="p">:</span><span class="s">&#39;_l&#39;</span><span class="p">,</span> <span class="s">&#39;xlarge&#39;</span><span class="p">:</span><span class="s">&#39;_xl&#39;</span><span class="p">}</span>

        <span class="c">#parts = self.path.name.split(&#39;.&#39;)</span>
        <span class="c">#self.last_four = parts[-2][-4:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_four</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>

<div class="viewcode-block" id="Image.dimensions"><a class="viewcode-back" href="../../api/path.html#moments.path.Image.dimensions">[docs]</a>    <span class="k">def</span> <span class="nf">dimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the dimensions of this image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>

    <span class="c">## def size_name(self, size):</span>
    <span class="c">##     &quot;&quot;&quot;</span>
    <span class="c">##     take a size and create the corresponding thumbnail filename</span>

    <span class="c">##     *2012.08.18 11:24:30</span>
    <span class="c">##     deprecated...</span>
    <span class="c">##     seems like it&#39;s only used in self.size_path method</span>
    <span class="c">##     simple enough to just include it there</span>
    <span class="c">##     &quot;&quot;&quot;</span>
    <span class="c">##     #parts = self.name.split(&#39;.&#39;)</span>
    <span class="c">##     #new_name = &#39;.&#39;.join(parts[:-1]) + self.sizes[size] + &#39;.&#39; + parts[-1]</span>
    <span class="c">##     #new_name = self.path.name + self.sizes[size] + &#39;.&#39; +self.path.extension</span>
    <span class="c">##     new_name = self.path.name + self.sizes[size] + self.path.extension</span>
    <span class="c">##     return new_name                  </span>
        

    <span class="c">## def get_size(self, size, relative=False):</span>
    <span class="c">##     &quot;&quot;&quot;</span>
    <span class="c">##     when size_path() just isn&#39;t enough...</span>
        
    <span class="c">##     accepts: tiny, small, medium, large</span>
    <span class="c">##     &quot;&quot;&quot;</span>
    <span class="c">##     thumb_path = self.size_path(size)</span>
    <span class="c">##     #if not os.path.isfile(thumb_path):</span>
    <span class="c">##     if not thumb_path.exists():</span>
    <span class="c">##         self.make_thumbs()</span>

    <span class="c">##     if relative:</span>
    <span class="c">##         #print self.path.relative_prefix</span>
    <span class="c">##         #thmb = Path(thumb_path, relative_prefix=self.path.relative_prefix)</span>
    <span class="c">##         thumb_path = thumb_path.to_relative()</span>
    <span class="c">##     return thumb_path</span>
</div>
<div class="viewcode-block" id="Image.move"><a class="viewcode-back" href="../../api/path.html#moments.path.Image.move">[docs]</a>    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        this utilizes the os.rename function</span>
<span class="sd">        but should also move thumbnails</span>

<span class="sd">        if relative is true, will expect a relative path that is</span>
<span class="sd">        joined with the local path</span>
<span class="sd">        otherwise destination is assumed to be full local path</span>

<span class="sd">        very similar functionality as minstream.import_media._move_image_and_thumbs()</span>
<span class="sd">        import_media uses subprocess system level move commands</span>
<span class="sd">        which is not as cross platform</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="c">#new_dir = os.path.join(image_dir, data)</span>
        <span class="p">(</span><span class="n">new_dir</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>

        <span class="c">#could also use os.renames()   note plural</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">new_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">new_dir</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>

        <span class="c">#move thumbnails</span>
        <span class="n">new_image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">destination</span><span class="p">)</span>
        <span class="c">#self.make_thumb_dirs(os.path.join(new_dir, self.thumb_dir_name))</span>
        <span class="n">new_image</span><span class="o">.</span><span class="n">make_thumb_dirs</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size_path</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">new_image</span><span class="o">.</span><span class="n">size_path</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Image.copy"><a class="viewcode-back" href="../../api/path.html#moments.path.Image.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">relative</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        copy the original image, along with all thumbs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
            </div>
<div class="viewcode-block" id="Image.size_path"><a class="viewcode-back" href="../../api/path.html#moments.path.Image.size_path">[docs]</a>    <span class="k">def</span> <span class="nf">size_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        take a size and create the corresponding thumbnail (local) path</span>

<span class="sd">        *2012.08.18 11:28:13 </span>
<span class="sd">        also, decide if a squared version of the image is requested</span>

<span class="sd">        seems like this is something that should be done here</span>
<span class="sd">        (and maybe both should be available)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="s">&#39;tiny_o&#39;</span><span class="p">:</span>
            <span class="c">#can keep the different tiny versions together:</span>
            <span class="n">size_dir</span> <span class="o">=</span> <span class="s">&#39;tiny&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size_dir</span> <span class="o">=</span> <span class="n">size</span>

        <span class="k">if</span> <span class="n">square</span><span class="p">:</span>
            <span class="n">size_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="n">size</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;_sq&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">extension</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="n">size</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">extension</span>

        <span class="c">#thumb_path = os.path.join(self.thumb_dir_path, size_dir, self.size_name(size))</span>
        <span class="n">thumb_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thumb_dir_path</span><span class="p">,</span> <span class="n">size_dir</span><span class="p">,</span> <span class="n">size_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">thumb_path</span><span class="p">,</span> <span class="n">relative_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relative_prefix</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Image.make_thumb_dirs"><a class="viewcode-back" href="../../api/path.html#moments.path.Image.make_thumb_dirs">[docs]</a>    <span class="k">def</span> <span class="nf">make_thumb_dirs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if they don&#39;t already exist, create them</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">base</span><span class="p">:</span>
            <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thumb_dir_path</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">base</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
            
        <span class="c">#make separate directories for each thumbnail size</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">!=</span> <span class="s">&#39;tiny_o&#39;</span><span class="p">:</span>
                <span class="n">size_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">size_path</span><span class="p">):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">size_path</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_square_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">destination</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">destination</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="c">#lets make it a square:</span>
            <span class="k">if</span> <span class="n">destination</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">destination</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">bigger</span> <span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">smaller</span><span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">bigger</span> <span class="o">-</span> <span class="n">smaller</span>
                <span class="n">first</span> <span class="o">=</span> <span class="n">diff</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">bigger</span> <span class="o">-</span> <span class="p">(</span><span class="n">diff</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span>
                <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">last</span><span class="p">,</span> <span class="n">smaller</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bigger</span> <span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">smaller</span><span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">bigger</span> <span class="o">-</span> <span class="n">smaller</span>
                <span class="n">first</span> <span class="o">=</span> <span class="n">diff</span><span class="o">/</span><span class="mi">2</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">bigger</span> <span class="o">-</span> <span class="p">(</span><span class="n">diff</span> <span class="o">-</span> <span class="n">first</span><span class="p">)</span>
                <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">smaller</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
            <span class="n">region</span> <span class="o">=</span> <span class="n">destination</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
            <span class="n">destination</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">destination</span>
        
<div class="viewcode-block" id="Image.make_thumbs"><a class="viewcode-back" href="../../api/path.html#moments.path.Image.make_thumbs">[docs]</a>    <span class="k">def</span> <span class="nf">make_thumbs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        regenerate all thumbnails from original</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">## if config.has_key(&#39;thumb.l&#39;):</span>
        <span class="c">##     l = int(config[&#39;thumb.l&#39;])</span>
        <span class="c">##     m = int(config[&#39;thumb.m&#39;])</span>
        <span class="c">##     s = int(config[&#39;thumb.s&#39;])</span>
        <span class="c">##     t = int(config[&#39;thumb.t&#39;])</span>
        <span class="c">##     u = int(config[&#39;thumb.u&#39;])</span>
        <span class="c">## else:</span>

        <span class="c">#this is still big (maybe too big?)</span>
        <span class="c">#but might shrink file size some?</span>
        <span class="n">xl</span> <span class="o">=</span> <span class="mi">2880</span>
        <span class="n">l</span> <span class="o">=</span> <span class="mi">1280</span>
        <span class="n">m</span> <span class="o">=</span> <span class="mi">800</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mi">400</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="c">#u = 25</span>

        <span class="c">#*2012.08.18 12:23:19 </span>
        <span class="c">#when rendering images for the web,</span>
        <span class="c">#now it&#39;s a good idea to set dimensions to half the size</span>
            
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">make_thumb_dirs</span><span class="p">()</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Error opening image: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#keep a copy of original for squaring</span>
            <span class="n">square</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">square</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_square_image</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>

            <span class="c">#made it this far... start resizing</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">image</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">((</span><span class="n">xl</span><span class="p">,</span><span class="n">xl</span><span class="p">),</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;Error sizing image: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                <span class="nb">exit</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">large</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">large</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">((</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="p">),</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>

                <span class="n">medium</span> <span class="o">=</span> <span class="n">large</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">medium</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">((</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">),</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>

                <span class="n">small</span> <span class="o">=</span> <span class="n">medium</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">small</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">((</span><span class="n">s</span><span class="p">,</span><span class="n">s</span><span class="p">),</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>

                <span class="n">tiny</span> <span class="o">=</span> <span class="n">small</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">tiny</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">((</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>

                <span class="c">#make squared versions</span>
                <span class="c">#xl_sq = square.copy()</span>
                <span class="c">#xl_sq.thumbnail((xl,xl), PILImage.ANTIALIAS)</span>

                <span class="c">#l_sq = xl_sq.copy()</span>
                <span class="n">l_sq</span> <span class="o">=</span> <span class="n">square</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">l_sq</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">((</span><span class="n">l</span><span class="p">,</span><span class="n">l</span><span class="p">),</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>

                <span class="n">m_sq</span> <span class="o">=</span> <span class="n">l_sq</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">m_sq</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">((</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">),</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>

                <span class="n">s_sq</span> <span class="o">=</span> <span class="n">m_sq</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">s_sq</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">((</span><span class="n">s</span><span class="p">,</span><span class="n">s</span><span class="p">),</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>

                <span class="n">t_sq</span> <span class="o">=</span> <span class="n">s_sq</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">t_sq</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">((</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">ANTIALIAS</span><span class="p">)</span>

                <span class="c">#o for original dimensions</span>
                <span class="c">#tiny_o = image.copy()</span>
                <span class="c">#we want to fix the width at t, not concerned about height</span>
                <span class="c">#tiny_o.thumbnail((t,1000), PILImage.ANTIALIAS)</span>

                <span class="c">## try:</span>
                <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size_path</span><span class="p">(</span><span class="s">&#39;xlarge&#39;</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span> <span class="s">&quot;JPEG&quot;</span><span class="p">)</span>
                <span class="n">large</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size_path</span><span class="p">(</span><span class="s">&#39;large&#39;</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span> <span class="s">&quot;JPEG&quot;</span><span class="p">)</span>
                <span class="n">medium</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size_path</span><span class="p">(</span><span class="s">&#39;medium&#39;</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span> <span class="s">&quot;JPEG&quot;</span><span class="p">)</span>
                <span class="n">small</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size_path</span><span class="p">(</span><span class="s">&#39;small&#39;</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span> <span class="s">&quot;JPEG&quot;</span><span class="p">)</span>
                <span class="n">tiny</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size_path</span><span class="p">(</span><span class="s">&#39;tiny&#39;</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span> <span class="s">&quot;JPEG&quot;</span><span class="p">)</span>

                <span class="n">l_sq</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size_path</span><span class="p">(</span><span class="s">&#39;large&#39;</span><span class="p">)),</span> <span class="s">&quot;JPEG&quot;</span><span class="p">)</span>
                <span class="n">m_sq</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size_path</span><span class="p">(</span><span class="s">&#39;medium&#39;</span><span class="p">)),</span> <span class="s">&quot;JPEG&quot;</span><span class="p">)</span>
                <span class="n">s_sq</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size_path</span><span class="p">(</span><span class="s">&#39;small&#39;</span><span class="p">)),</span> <span class="s">&quot;JPEG&quot;</span><span class="p">)</span>
                <span class="n">t_sq</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size_path</span><span class="p">(</span><span class="s">&#39;tiny&#39;</span><span class="p">)),</span> <span class="s">&quot;JPEG&quot;</span><span class="p">)</span>

                
                <span class="c">#tiny_o.save(str(self.size_path(&#39;tiny_o&#39;)), &quot;JPEG&quot;)</span>
                <span class="c">## except:</span>
                <span class="c">##     print &quot;error generating thumbs for: %s&quot; % self.path.name</span>
                <span class="c">##     #pass</span>

    <span class="c">## def reset_stats(self):</span>
    <span class="c">##     &quot;&quot;&quot;</span>
    <span class="c">##     some actions (like image rotate) may update the file&#39;s modified times</span>
    <span class="c">##     but we might want to keep the original time</span>

    <span class="c">##     this should redefine File.reset_stats for images only</span>
    <span class="c">##     &quot;&quot;&quot;</span>
    <span class="c">##     #this resets them to what they were when originally initialized</span>
    <span class="c">##     #os.utime(str(self.path), (self.atime, self.mtime))</span>

    <span class="c">##     #might be better to get the actual time from the image meta data</span>
    <span class="c">##     os.system(&quot;jhead -ft %s&quot; % (self.path))</span>
</div>
    <span class="k">def</span> <span class="nf">datetime_exif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#resets the timestamp of the file to what was stored in exif header</span>
        <span class="c">#this will print the filepath to the console</span>
        <span class="n">meta</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;jhead -ft </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="c">#print &quot;TIMESTAMP FROM EXIF: %s&quot; % meta</span>
        <span class="c">#not sure that meta will have a value here</span>
        <span class="c">#just 0, no error</span>
        <span class="c">#return meta</span>

<div class="viewcode-block" id="Image.rotate_pil"><a class="viewcode-back" href="../../api/path.html#moments.path.Image.rotate_pil">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_pil</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degrees</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rotate image by number of degrees (clockwise!!)</span>

<span class="sd">        use Python Image Library</span>

<span class="sd">        PIL is very LOSSY!!</span>

<span class="sd">        will also lose original EXIF data</span>

<span class="sd">        (but it does work if you don&#39;t have access to jhead/jpegtran)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#standard PIL goes counter-clockwise</span>
        <span class="c">#should adjust here</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="mi">360</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">degrees</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">PILImage</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="n">im2</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">degrees</span><span class="p">))</span>
        <span class="n">im2</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s">&quot;JPEG&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_thumbs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_stats</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="Image.rotate"><a class="viewcode-back" href="../../api/path.html#moments.path.Image.rotate">[docs]</a>    <span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degrees</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        rotate image by number of degrees (clockwise!!)</span>

<span class="sd">        need to reset file timestamp to be original</span>
<span class="sd">        especially if not keeping track of that elsewhere</span>

<span class="sd">        see also Directory.auto_rotate_images()</span>

<span class="sd">        but if you need to tune individually, better to call jpegtrans here</span>

<span class="sd">        jhead -cmd &quot;jpegtran -progressive -rotate 90 &amp;i &gt; &amp;o&quot; IMG_4965.JPG</span>

<span class="sd">        http://www.sentex.net/~mwandel/jhead/usage.html</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;jhead -cmd </span><span class="se">\&quot;</span><span class="s">jpegtran -progressive -rotate </span><span class="si">%s</span><span class="s"> &amp;i &gt; &amp;o</span><span class="se">\&quot;</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">degrees</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_thumbs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_stats</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">auto_rotate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">jhead</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s">&quot;jhead -autorot </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="n">current</span> <span class="o">=</span> <span class="n">jhead</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c">#print &quot;Finished rotating: %s, %s&quot; % (self.name, current)</span>
        <span class="k">if</span> <span class="n">current</span><span class="p">:</span> <span class="k">print</span> <span class="n">current</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">current</span>
        <span class="c">#make sure timestamps stay the same</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_stats</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="Directory"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory">[docs]</a><span class="k">class</span> <span class="nc">Directory</span><span class="p">(</span><span class="n">File</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This object holds a summary of a single directory.</span>
<span class="sd">    (no recursion.  one level only)</span>

<span class="sd">    A Directory is a collection of Path objects. </span>
<span class="sd">    They can be sortable based on types, dates, etc.</span>
<span class="sd">    Each of the Paths can handle loading and types.</span>

<span class="sd">    Directories on the filesystem share many properties with Files,</span>
<span class="sd">    so the Directory class is a subclass of the File class. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">File</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c">#print &quot;initializing directory: %s&quot; % self.path</span>


        <span class="c">#self.ignores = []</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ignores</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;.hg&#39;</span><span class="p">,</span> <span class="s">&#39;.hgignore&#39;</span><span class="p">,</span> <span class="s">&#39;.svn&#39;</span><span class="p">,</span> <span class="s">&#39;index.xml&#39;</span><span class="p">,</span> <span class="s">&#39;meta.txt&#39;</span><span class="p">,</span> <span class="s">&#39;sized&#39;</span><span class="p">,</span> <span class="s">&#39;.DS_Store&#39;</span><span class="p">,</span> <span class="s">&#39;.HFS+ Private Directory Data&#39;</span><span class="p">,</span> <span class="s">&#39;.HFS+ Private Directory Data</span><span class="se">\r</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;.fseventsd&#39;</span><span class="p">,</span> <span class="s">&#39;.Spotlight-V100&#39;</span><span class="p">,</span> <span class="s">&#39;.TemporaryItems&#39;</span><span class="p">,</span> <span class="s">&#39;.Trash-ubuntu&#39;</span><span class="p">,</span> <span class="s">&#39;.Trashes&#39;</span><span class="p">,</span> <span class="s">&#39;lost+found&#39;</span> <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_directory</span><span class="p">()</span>

<div class="viewcode-block" id="Directory.reset"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if we&#39;ve already scanned something once, and a subsequent scan is called,</span>
<span class="sd">        we&#39;ll want to reset ourself so duplicates are not added (common mistake)</span>
<span class="sd">        this is the same thing that happens during initialization,</span>
<span class="sd">        so breaking it out here</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#string only version</span>
        <span class="c">#(sometimes it is easier to use just strings... like diff directories)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">listdir</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c">#everything</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directories</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">playlists</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">libraries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sounds</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">movies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">documents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">other</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_scan</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filetypes_scanned</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c">#how many items we have total</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

        </div>
<div class="viewcode-block" id="Directory.scan_directory"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.scan_directory">[docs]</a>    <span class="k">def</span> <span class="nf">scan_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        only load paths</span>

<span class="sd">        this will clear out any previous scans to avoid duplication</span>
<span class="sd">        reset includes filetypes and sorts</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_scan</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">listdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">listdir</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ignores</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                
                <span class="c">#print &quot;SUPPORTS UNICODE: %s&quot; % os.path.supports_unicode_filenames</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">supports_unicode_filenames</span><span class="p">:</span>
                    <span class="n">item_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">item</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">#item_path = unicode(self.path) + u&#39;/&#39; + unicode(item)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">item_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">item</span><span class="p">))</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">item_path</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="k">print</span> <span class="s">&quot;could not open: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">item</span>

                <span class="n">item_path</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">item_path</span><span class="p">)</span>
                <span class="c">#propagate any relative settings passed to us</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">item_path</span><span class="p">,</span> <span class="n">relative_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relative_prefix</span><span class="p">)</span>

                <span class="c">#everything</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">item_path</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                    
                <span class="k">elif</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">item_path</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">directories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&quot;ERROR: unknown item found; not a file or directory:&quot;</span>
                    <span class="k">print</span> <span class="n">item_path</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_scan</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">()</span>

        <span class="c">#if we don&#39;t sort now, it will be more work to sort later</span>
        <span class="c">#self.directories.sort()</span>
        </div>
<div class="viewcode-block" id="Directory.scan_filetypes"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.scan_filetypes">[docs]</a>    <span class="k">def</span> <span class="nf">scan_filetypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        look in the directory&#39;s list of files for different types of files</span>
<span class="sd">        put them in the right list type in the directory</span>

<span class="sd">        should have already scanned the directory for files</span>

<span class="sd">        we will look through the list of files</span>
<span class="sd">        for files that are likely images</span>
<span class="sd">        then populate that list</span>

<span class="sd">        not sure if this should always happen at scan time</span>
<span class="sd">        what if we don&#39;t need to use images, sounds, movies?  extra step</span>
<span class="sd">        maybe only create special node types if they&#39;re needed. </span>
<span class="sd">        </span>
<span class="sd">        depending on the file extension, should create an object</span>
<span class="sd">        with the appropriate type</span>
<span class="sd">        and add it to the correct list in the Directory</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="c"># we should only need to scan the filetypes once per instance:</span>
        <span class="c"># (don&#39;t want to end up with duplicates)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filetypes_scanned</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">type</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Image&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Movie&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Playlist&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">playlists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Sound&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sounds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Log&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="s">&quot;Document&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">documents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c">#must be something else:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">other</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">filetypes_scanned</span> <span class="o">=</span> <span class="bp">True</span>
                    </div>
    <span class="k">def</span> <span class="nf">sort_by_date</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">dates</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c">#just in case something is looking</span>
        <span class="c">#at 1 of the 3 main groups for a directory</span>
        <span class="c">#(contents, files, directories)</span>
        <span class="c">#instead of just files (more common)</span>
        <span class="c">#we&#39;ll update all 3</span>

        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">:</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">datetime</span><span class="p">()</span>
            <span class="n">dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">dates</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directories</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c">#print &quot;AFTER SORT: &quot;</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dates</span><span class="p">:</span>
            <span class="c">#print &quot;%s, %s&quot; % (d[0], d[1])</span>
            <span class="n">item_path</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_path</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item_path</span><span class="p">))):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_path</span><span class="p">)</span>

            <span class="k">elif</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item_path</span><span class="p">))):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item_path</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">sort_by_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filetype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">filetype</span> <span class="o">==</span> <span class="s">&quot;File&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">filetype</span> <span class="o">==</span> <span class="s">&quot;Directory&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directories</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">filetype</span> <span class="o">==</span> <span class="s">&quot;Image&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">filetype</span> <span class="o">==</span> <span class="s">&quot;Movie&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">movies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">filetype</span> <span class="o">==</span> <span class="s">&quot;Playlist&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">playlists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">playlists</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">filetype</span> <span class="o">==</span> <span class="s">&quot;Sound&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sounds</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">filetype</span> <span class="o">==</span> <span class="s">&quot;Log&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">filetype</span> <span class="o">==</span> <span class="s">&quot;Document&quot;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">documents</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c">#recursively call self for all filetypes</span>
            <span class="n">all_types</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&quot;Image&quot;</span><span class="p">,</span> <span class="s">&quot;Movie&quot;</span><span class="p">,</span> <span class="s">&quot;Playlist&quot;</span><span class="p">,</span> <span class="s">&quot;Sound&quot;</span><span class="p">,</span> <span class="s">&quot;Log&quot;</span><span class="p">,</span>
                          <span class="s">&quot;Document&quot;</span><span class="p">,</span> <span class="s">&quot;File&quot;</span><span class="p">,</span> <span class="s">&quot;Directory&quot;</span> <span class="p">]</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">all_types</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sort_by_path</span><span class="p">(</span><span class="n">filetype</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sort_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">):</span>
        <span class="n">strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">collection</span><span class="p">:</span>
            <span class="n">strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">unicode</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="n">strings</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">:</span>
            <span class="n">paths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">relative_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relative_prefix</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">paths</span>                

<div class="viewcode-block" id="Directory.check_size"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.check_size">[docs]</a>    <span class="k">def</span> <span class="nf">check_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recurse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Go through all files and add up the size. </span>

<span class="sd">        It is possible to recursively add up sizes of subdirectories,</span>
<span class="sd">        but this can be a resource intensive operation.</span>
<span class="sd">        Be careful when setting recurse=True. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="n">item_path</span><span class="p">)</span>
                <span class="n">node</span><span class="o">.</span><span class="n">check_size</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">size</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">node</span><span class="o">.</span><span class="n">size</span>
                    
            <span class="k">if</span> <span class="n">recurse</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">directories</span><span class="p">:</span>
                    <span class="n">sub_d</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">sub_d</span><span class="o">.</span><span class="n">directory_size</span><span class="p">(</span><span class="n">recurse</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">#print &quot;Not recursing; no size found for sub-directories&quot;</span>
                <span class="c">#print item_path</span>
                <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Directory.file_date_range"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.file_date_range">[docs]</a>    <span class="k">def</span> <span class="nf">file_date_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate a name based on the range of dates for files in this directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_by_date</span><span class="p">()</span>

        <span class="n">new_name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="n">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">start</span> <span class="o">!=</span> <span class="n">end</span><span class="p">:</span>
            <span class="n">new_name</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="n">end</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_name</span> <span class="o">=</span> <span class="n">start</span>

        <span class="k">return</span> <span class="n">new_name</span>
</div>
<div class="viewcode-block" id="Directory.adjust_time"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.adjust_time">[docs]</a>    <span class="k">def</span> <span class="nf">adjust_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        adjust the modified time of all files in the directory by the number</span>
<span class="sd">        of hours specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">fpath</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">adjust_time</span><span class="p">(</span><span class="n">hours</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Directory.files_to_journal"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.files_to_journal">[docs]</a>    <span class="k">def</span> <span class="nf">files_to_journal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filetype</span><span class="o">=</span><span class="s">&quot;Image&quot;</span><span class="p">,</span> <span class="n">journal_file</span><span class="o">=</span><span class="s">&quot;action.txt&quot;</span><span class="p">,</span> <span class="n">full_path</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        *2010.12.22 06:49:41</span>
<span class="sd">        seems similar in function to create_journal</span>
<span class="sd">        this is a bit easier to understand from the name though</span>

<span class="sd">        this is used by</span>
<span class="sd">        /c/moments/scripts/import_usb.py</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#just incase we haven&#39;t:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_filetypes</span><span class="p">()</span>
        
        <span class="n">jpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">journal_file</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">load_journal</span><span class="p">(</span><span class="n">jpath</span><span class="p">,</span> <span class="n">create</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s">&quot;Image&quot;</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;camera&#39;</span><span class="p">,</span> <span class="s">&#39;image&#39;</span><span class="p">,</span> <span class="s">&#39;capture&#39;</span><span class="p">,</span> <span class="s">&#39;created&#39;</span> <span class="p">]</span>
        <span class="k">elif</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s">&quot;Sound&quot;</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sounds</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;sound&#39;</span><span class="p">,</span> <span class="s">&#39;recorded&#39;</span><span class="p">,</span> <span class="s">&#39;created&#39;</span> <span class="p">]</span>
        <span class="k">elif</span> <span class="n">filetype</span> <span class="o">==</span> <span class="s">&quot;File&quot;</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;file&#39;</span><span class="p">,</span> <span class="s">&#39;created&#39;</span> <span class="p">]</span>

        <span class="k">for</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="c">#could also use j.make() here:</span>
            <span class="c">#e = Moment()</span>
            <span class="c">#e.created = Timestamp(i.datetime())</span>
            <span class="c">#e.tags = tags</span>
            <span class="c">#e.data = i.path</span>
            <span class="c">#j.update_entry(e)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">fpath</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">full_path</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fpath</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">j</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">datetime</span><span class="p">())</span>

        <span class="c">#print j</span>
        <span class="c">#j.sort_entries(&quot;reverse-chronological&quot;)</span>
        <span class="c">#l = Log(filename)</span>
        <span class="c">#j.save(&#39;temp.txt&#39;)</span>
        <span class="n">j</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">jpath</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">&quot;reverse-chronological&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Directory.create_journal"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.create_journal">[docs]</a>    <span class="k">def</span> <span class="nf">create_journal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">journal</span><span class="o">=</span><span class="s">&quot;action.txt&quot;</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="s">&quot;Images&quot;</span><span class="p">,</span> <span class="n">full_path</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if we don&#39;t have a journal</span>
<span class="sd">        create one using the items of type items</span>

<span class="sd">        adapted from moments/scripts/images_to_journal.py</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">j</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">journal</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">Journal</span><span class="p">()</span>
            <span class="n">j</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

        <span class="n">source</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">journal</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">j</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scan_filetypes</span><span class="p">()</span>

            <span class="c">#this will not propigate to log</span>
            <span class="c">#creation times will take priority</span>
            <span class="c">#self.sort_by_path(&quot;Image&quot;)</span>
            
            <span class="c">#print self.images</span>
            <span class="c">#app.sources = self.images</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">Journal</span><span class="p">()</span>

            <span class="c">#TODO:</span>
            <span class="c">#if other item types are desired in the log</span>
            <span class="c">#items can be a list of types to check for</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
                <span class="c">#e = Moment()</span>

                <span class="c">#this works, but if the file timestamp has been modified</span>
                <span class="c">#it won&#39;t be set to when the picture was taken:</span>
                <span class="n">created</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">datetime</span><span class="p">())</span>

                <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;image&#39;</span> <span class="p">]</span>
                <span class="c">#*2010.12.28 16:51:12 </span>
                <span class="c">#image.path is likely to change over time</span>
                <span class="c">#as tags are added to the directory, etc</span>
                <span class="c">#just use the file name in the local action tags</span>
                <span class="c">#elsewhere, full path is fine, knowing that it might change, but better than nothing</span>
                <span class="k">if</span> <span class="n">full_path</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="c">#j.update_entry(e)</span>
                <span class="n">j</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">tags</span><span class="p">,</span> <span class="n">created</span><span class="p">)</span>

            <span class="n">j</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s">&quot;chronological&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Journal: </span><span class="si">%s</span><span class="s"> already exists&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">source</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">j</span>

    <span class="c">#rename to generate_thumbnails?        </span></div>
<div class="viewcode-block" id="Directory.make_thumbs"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.make_thumbs">[docs]</a>    <span class="k">def</span> <span class="nf">make_thumbs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate thumbnails for all images in this directory</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_filetypes</span><span class="p">()</span>
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
                <span class="n">i</span><span class="o">.</span><span class="n">load</span><span class="p">()</span><span class="o">.</span><span class="n">make_thumbs</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Directory.default_file"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.default_file">[docs]</a>    <span class="k">def</span> <span class="nf">default_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        usually just want an image</span>
<span class="sd">        but if there are no images, we may want to look for other file types</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Directory.summary"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.summary">[docs]</a>    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        standard way of representing the directory concisely?</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Directory.default_image"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.default_image">[docs]</a>    <span class="k">def</span> <span class="nf">default_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pick_by</span><span class="o">=</span><span class="s">&quot;random&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        if we have an action log, use that regardless of pick_by</span>

<span class="sd">        Not currently configured to work with RemoteJournal</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_filetypes</span><span class="p">()</span>
        <span class="c">#print &quot;%s has %s images&quot; % (self.path.name, len(self.images))</span>
        <span class="n">choice</span> <span class="o">=</span> <span class="bp">None</span>           
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">):</span>

            <span class="n">dest</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="s">&quot;action.txt&quot;</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">load_journal</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">j</span><span class="p">:</span>
                <span class="c">#2009.12.19 13:19:27 </span>
                <span class="c">#need to generate the data association first now</span>
                <span class="n">j</span><span class="o">.</span><span class="n">associate_files</span><span class="p">()</span>

                <span class="n">most_frequent</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="n">_files</span><span class="o">.</span><span class="n">frequency_list</span><span class="p">()</span>
                <span class="n">most_frequent</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="n">most_frequent</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s">&quot;20100522-rebel-slr&quot;</span><span class="p">:</span>
                    <span class="k">print</span> <span class="n">most_frequent</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">choice</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">most_frequent</span><span class="p">):</span>
                    <span class="n">next_option</span> <span class="o">=</span> <span class="n">most_frequent</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">file_part</span> <span class="o">=</span> <span class="n">next_option</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">path_part</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="n">file_part</span><span class="p">)</span>
                    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path_part</span><span class="p">,</span> <span class="n">relative_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relative_prefix</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;Image&quot;</span><span class="p">:</span>
                            <span class="n">choice</span> <span class="o">=</span> <span class="n">path</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">print</span> <span class="s">&quot;couldn&#39;t find: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">path</span>
                
            <span class="k">elif</span> <span class="n">pick_by</span> <span class="o">==</span> <span class="s">&quot;random&quot;</span><span class="p">:</span>
                <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">()</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">choice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c">#must not have found anything statistical if we make it here</span>
                <span class="c">#just return the first one in the list</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c">#print &quot;No images available in: %s&quot; % self.path.name</span>
            <span class="c">#choice will be None:</span>
            <span class="k">pass</span>

        <span class="c">#FOR DEBUG:</span>
        <span class="c">## if choice:</span>
        <span class="c">##     print &quot;default image: %s&quot; % choice.path</span>
        <span class="c">## else:</span>
        <span class="c">##     print &quot;NO IMAGE FOUND!&quot;</span>

        <span class="k">return</span> <span class="n">choice</span>
</div>
<div class="viewcode-block" id="Directory.auto_rotate_images"><a class="viewcode-back" href="../../api/path.html#moments.path.Directory.auto_rotate_images">[docs]</a>    <span class="k">def</span> <span class="nf">auto_rotate_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_thumbs</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        #it&#39;s best to just use:</span>
<span class="sd">        jhead -autorot *.JPG</span>

<span class="sd">        this resets the last modified timestamp to now()</span>
<span class="sd">        not what we want, so go through and reset all timestamps</span>
<span class="sd">        to original times</span>

<span class="sd">        http://www.sentex.net/~mwandel/jhead/</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scan_filetypes</span><span class="p">()</span>
        <span class="c">#image_list = self.get_images()</span>
        <span class="c">#images = image_list.as_objects()</span>
        <span class="c">#images = self.images</span>

        <span class="c">#load the images as File based objects so that we can reset timestamps later</span>
        <span class="c">#print &quot;loading images:&quot;</span>
        <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ipath</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">ipath</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
            <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c">#os.system(&quot;jhead -autorot %s/*.JPG&quot; % self.path)</span>
        <span class="c">#result = os.popen(&quot;jhead -autorot %s/*.JPG&quot; % self.path)</span>
        <span class="c">#jhead = subprocess.Popen(&quot;jhead -autorot %s/*.JPG&quot; % self.path, shell=True, stdout=subprocess.PIPE)</span>
        <span class="c">#jhead.wait()</span>
        <span class="c">#result = jhead.stdout.read()</span>

        <span class="c">#print &quot;rotating images:&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">i</span><span class="o">.</span><span class="n">auto_rotate</span><span class="p">()</span>
            
        <span class="c">#similar issue with thumbnails... not updated</span>
        <span class="c">#for these we only want to regenerate those that changed for speed</span>
        <span class="c">#print &quot;regenerating thumbnails:&quot;</span>
        <span class="n">new_result</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">update_thumbs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                    <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;Modified: &#39;</span><span class="p">)</span>
                    <span class="n">new_result</span> <span class="o">+=</span> <span class="n">path</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                    <span class="n">i</span><span class="o">.</span><span class="n">make_thumbs</span><span class="p">()</span>
                
        <span class="c">#can reset all image stat, even those not rotated, just to simplify task</span>
        <span class="c">#print &quot;resetting file timestamps:&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">images</span><span class="p">:</span>
            <span class="n">i</span><span class="o">.</span><span class="n">reset_stats</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">new_result</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">Moments 2.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Charles Brandt.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>